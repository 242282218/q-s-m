# 对接流程.md — 项目对接与集成指南

> 目标：明确项目各阶段的对接要求、接口规范和集成流程
> 核心原则：可追溯、可验证、可扩展

---

## 1. 项目概述

### 1.1 项目背景

TMDB海报墙应用是一个基于FastAPI和Jinja2的Web应用，用于展示电影和电视剧的海报墙，并提供搜索和详情查看功能。本项目现已集成夸克搜索功能，可以通过TMDB ID或标题搜索相关的夸克网盘资源。

### 1.2 核心功能

- TMDB电影/电视剧信息展示
- 搜索功能
- 详情页展示
- 夸克资源搜索功能

---

## 2. 对接阶段定义

### 2.1 阶段划分

| 阶段 | 名称 | 描述 |
|------|------|------|
| M-STRUCT | 结构规范 | 项目目录结构、代码规范、配置规范 |
| M0 | 基础功能 | 核心功能实现，可独立运行 |
| M1 | 集成功能 | 与外部服务集成，如夸克搜索 |
| M2 | 优化与测试 | 性能优化、测试覆盖、文档完善 |
| M3 | 部署与交付 | 部署配置、监控、交付文档 |

### 2.2 当前阶段

- 当前阶段：`M1`
- 目标：完成夸克搜索功能集成
- 状态：`Done`

---

## 3. 接口规范

### 3.1 TMDB API 接口

| 接口 | 说明 | 调用方式 |
|------|------|----------|
| 电影详情 | 获取电影详细信息 | `GET /movie/{id}` |
| 电视剧详情 | 获取电视剧详细信息 | `GET /tv/{id}` |
| 搜索 | 搜索电影/电视剧 | `GET /search/multi` |

### 3.2 夸克搜索 API 接口

| 接口 | 说明 | 调用方式 |
|------|------|----------|
| 通过TMDB ID搜索 | 通过TMDB ID搜索夸克资源 | `GET /api/quark/search/tmdb/{tmdb_id}` |
| 通过标题搜索 | 通过标题搜索夸克资源 | `GET /api/quark/search/title` |

---

## 4. 集成流程

### 4.1 环境准备

1. 安装依赖：`pip install -r requirements.txt`
2. 创建.env文件：`cp .env.example .env`
3. 配置TMDB_API_KEY：在.env文件中填入有效的TMDB API密钥

### 4.2 启动服务

```bash
cd backend
python -m uvicorn app.main:app --port 7788
```

### 4.3 验证集成

1. 访问首页：http://localhost:7788
2. 测试TMDB搜索功能：http://localhost:7788/search?q=复仇者联盟
3. 测试夸克搜索功能：http://localhost:7788/api/quark/search/title?title=复仇者联盟&year=2012

---

## 5. 配置管理

### 5.1 配置文件

- `.env`：生产环境配置
- `.env.example`：配置示例

### 5.2 核心配置项

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| TMDB_API_KEY | TMDB API密钥 | 必填 |
| QUARK_SEARCH_BASE_URL | 夸克搜索API地址 | https://api.quark.sogou.com |
| QUARK_SEARCH_MAX_RESULTS | 夸克搜索最大结果数 | 20 |

---

## 6. 代码规范

### 6.1 命名规范

- 文件名：小写+下划线
- 类名：驼峰命名
- 函数名：小写+下划线
- 变量名：小写+下划线

### 6.2 代码结构

- 核心功能：`backend/app/core/`
- API路由：`backend/app/api/`
- 服务层：`backend/app/services/`
- 数据模型：`backend/app/models/`
- 配置：`backend/app/config.py`

---

## 7. 测试规范

### 7.1 测试类型

- 单元测试：测试单个函数或类
- 集成测试：测试模块间的集成
- 冒烟测试：测试核心功能是否正常运行

### 7.2 测试命令

```bash
# 运行冒烟测试
python -m scripts.smoke

# 运行所有测试
pytest
```

---

## 8. 文档规范

### 8.1 文档类型

- `README.md`：项目概述、快速开始
- `开发进度文档.md`：开发进度日志
- `对接流程.md`：对接与集成指南
- `docs/HANDOFF.md`：交接文档

### 8.2 更新频率

- 每完成一个迭代，必须更新开发进度文档.md
- 每更新开发进度文档.md，必须同步更新docs/HANDOFF.md

---

## 9. 故障排查

### 9.1 常见问题

1. TMDB API调用失败
   - 检查TMDB_API_KEY是否有效
   - 检查网络连接

2. 夸克搜索返回空结果
   - 检查夸克搜索API地址是否正确
   - 检查搜索关键词是否符合要求

3. 服务启动失败
   - 检查端口是否被占用
   - 检查依赖是否安装完整

### 9.2 日志查看

```bash
# 查看服务日志
python -m uvicorn app.main:app --port 7788 --log-level info
```

---

## 10. 下一步计划

1. 完善测试覆盖
2. 优化性能
3. 完善文档
4. 部署配置

---

## 11. 联系方式

- 项目负责人：
- 技术支持：
- 文档更新：

---

## 12. 版本历史

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| v1.0 | 2026-01-08 | 初始版本，包含夸克搜索功能集成 | AI Assistant |