# 夸克资源排序与打分算法研究

> 本文档整理自一次完整的算法共创对话，目标是：**在搜索结果中有效过滤垃圾资源，并在高置信度前提下，让高质量影视资源自然排前**。文档可作为研究记录、工程设计说明或后续论文/系统实现依据。

---

## 1. 问题背景与研究目标

在夸克网盘等资源搜索场景中，常见问题包括：

- 大量 **垃圾资源**（文案、教程、脚本、APK、游戏包）混入搜索结果
- **虚标质量**（标题写 4K / 原盘 / REMUX，但体积只有 KB/MB）
- 搜索排序中过度依赖文本相关度，导致：
  - 置信度权重低 → 错误结果靠“高质量标签”冲到前面
  - 置信度权重高 → 大量低质量但“看起来很相关”的资源霸榜

### 研究目标

1. 在 **不依赖用户点击日志** 的前提下，仅基于静态字段（name / size / views / updatetime）
2. 构建一套 **可解释、可调参、可工程化** 的资源打分算法
3. 明确解决：
   - 垃圾资源过滤
   - 虚标资源识别
   - 高置信度场景下“质量主导排序”的问题

---

## 2. 可用信号分析（Input Signals）

### 2.1 原始字段

来自 `quark_search_results.json` 的主要字段：

- `name`：资源标题（核心信号）
- `size`：体积字符串（如 `32.4G / 126.8KB`）
- `views`：浏览量
- `updatetime`：更新时间（ISO 格式）
- `search_keyword`：搜索词（query）

### 2.2 可抽取的隐含信号

从 `name` 中可抽取：

- **分辨率**：4K / 2160p / 1080p / 720p
- **画面规格**：HDR / Dolby Vision (DV)
- **片源类型**：BDMV / 原盘 / REMUX / BluRay / WEB-DL
- **音频规格**：TrueHD / Atmos / DTS:X / DTS-HD / DDP
- **字幕信息**：特效字幕 / 外挂 / 中字
- **结构信息**：合集 / 全X部 / 全季

这些信号共同构成 **质量判定（Quality）** 与 **可信度判定（Confidence）** 的基础。

---

## 3. 整体算法结构（Final Architecture）

### 3.1 两阶段设计（核心思想）

```
Stage 0: 强过滤（Hard Filter）
    ↓
Stage 1: 置信度 Conf + 质量 Qual 融合打分
```

**关键结论**：
> 如果不先做强过滤，后续任何权重/模型都会被“虚标 + 垃圾”拖垮。

---

## 4. Stage 0：强过滤规则（Hard Filter）

用于 **一票否决** 明显错误或非影视资源。

### 4.1 文档 / 程序类资源

直接过滤：

- 文档：`.pdf .txt .doc(x) .ppt(x) .xls(x) .epub`
- 程序：`.apk .exe .torrent`

### 4.2 小体积压缩包

- `.zip / .rar / .7z` 且 `size < 0.7GB` → 高概率是文案 / 教程 / 软件

### 4.3 强矛盾规则（最关键）

```
若 size < 0.5GB 且 name 命中：
{4K, 原盘, REMUX, BDMV, BluRay, DV, HDR}
→ 直接淘汰
```

该规则有效清除了：
- “1080P 高清全集 126KB”
- “4K 原盘合集 3.1MB”

---

## 5. 置信度模型 Conf(x)

### 5.1 Conf 的定位

- **不是简单加分项，而是门禁（Gate）**
- 负责回答：**“这是不是你要找的那个东西？”**

### 5.2 Conf 组成

| 子项 | 含义 |
|----|----|
| C_text | query 与 name 的匹配程度 |
| C_intent | 是否像“影视资源” |
| C_plaus | 体积是否可信 |

#### 文本匹配（C_text）

- 子串命中 → 1.0
- 否则使用 **2-gram Jaccard + token 覆盖率**
- 防止“雷神 vs 雷霆沙赞”这种蹭词

#### 意图一致（C_intent）

- 命中负向词（解说文案 / 教程 / 游戏 / 小说）→ 0
- 有视频证据（分辨率 / 编码 / 字幕 / 片源）→ 提升

#### 体量可信（C_plaus）

- 基于 `tags × size` 的合理区间判断
- 极端矛盾 → 0

### 5.3 Conf 融合公式

```
Conf = C_text × (0.7 + 0.3 × avg(C_intent, C_plaus))

if C_text < 0.25 or C_intent == 0:
    Conf *= 0.15
```

并设下限：

```
Conf < 0.08 → 直接沉底
```

---

## 6. 质量模型 Qual(x)

### 6.1 设计原则

- 点数制 → 归一化
- 可解释、可调参

### 6.2 质量加分表（示例）

- 分辨率：4K +25；1080P +15；720P +6
- 片源：BDMV +35；REMUX +30；BluRay +24；WEB-DL +18
- HDR：DV +20；HDR +10
- 音频：Atmos +10；DTS:X +8；TrueHD +6
- 编码：x265 +4；x264 +2
- 字幕：特效字幕 +6；中字 +3
- 多音轨：+4
- 冲突惩罚：4K & 1080P 同时出现 → -12

```
Qual = clamp(points / 110, 0, 1)
```

---

## 7. 动态融合与阶梯权重（核心创新点）

### 7.1 设计动机

解决：
- 置信度太低 → 错结果
- 置信度太高 → 低质霸榜

### 7.2 阶梯权重 α(Conf)

| Conf 区间 | α（置信度权重） | 含义 |
|---------|---------------|------|
| < 0.5 | 0.7 | 强保证相关性 |
| 0.5 – 0.8 | 0.55 | 平衡 |
| ≥ 0.8 | 0.4 | **质量主导** |

若：

```
C_text ≥ 0.8 且 C_intent ≥ 0.8 且 C_plaus ≥ 0.8
→ α -= 0.1
```

即：**zxd 都很高时，进一步降低置信度占比**。

---

## 8. 最终打分公式

```
Total = α(Conf) × Conf
      + (1 - α(Conf)) × Qual
      + gate(Conf) × (0.10 × Popularity + 0.05 × Freshness)
```

其中：

- `Popularity = log1p(views) / log1p(200)`
- `Freshness = exp(-days / 60)`
- `gate(Conf)`：Conf ≥ 0.6 才允许热度/新鲜度生效

---

## 9. 实验结果与效果总结

### 9.1 有效过滤

- KB/MB 级“4K 原盘” → 100% 淘汰
- 解说文案 / 教程 / zip → 全部移除

### 9.2 排序质量提升

- 高置信度场景下：
  - REMUX / 原盘 / 杜比视界 自动排前
  - 普通 WEB-DL / 小体积自然靠后

### 9.3 用户主观反馈

> “非常有效过滤了垃圾，用 AI 来，最有用的一次。”

---

## 10. 后续迭代方向（v4+）

1. **媒体证据分 C_media_evidence**（是否有 mkv/mp4/x265/字幕/音轨证据）
2. **同名资源聚类去重**（避免刷屏）
3. **体量区间数据驱动校准（P10–P90）**
4. **灰区池机制**（高质量但中等 Conf）
5. **工程化：作为 Search / Rerank 模块独立部署**

---

## 11. 结语

本研究证明：

> **在无点击日志条件下，基于规则 + AI 设计的分层置信度与质量融合模型，已经可以达到“专业资源站级别”的搜索排序效果。**

该方案具有：
- 高可解释性
- 强工程落地性
- 清晰的迭代路径

可直接用于：
- 垂直搜索
- 网盘资源整理
- 毕设 / 论文 / 产品原型

